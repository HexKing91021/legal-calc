<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA 5 Legal Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        body { padding-top: 20px; padding-bottom: 20px; }
        .charge-item { margin-bottom: 10px; position: relative; }
        .description { max-width: 300px; overflow-wrap: break-word; }
        .discount-btn { margin-right: 5px; margin-bottom: 5px; }
        .description-short { 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            max-width: 200px; 
            display: inline-block;
        }
        .description-toggle { 
            cursor: pointer; 
            color: blue;
            text-decoration: underline;
            position: relative;
        }
        .description-toggle .tooltip-text {
            visibility: hidden;
            width: 300px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .description-toggle:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .charge-input {
            border: 2px solid #007bff;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 16px;
            width: 100%;
            position: relative;
        }
        .charge-input:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0,123,255,0.5);
        }
        .custom-dropdown {
            background-color: white;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            z-index: 1000;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }
        .custom-dropdown-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            white-space: nowrap;
        }
        .custom-dropdown-item:hover {
            background-color: #007bff;
            color: white;
        }
        .license-revocation {
            background-color: #fff3cd;
        }
        #licenseRevocationWarning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
        }
        .warning-icon {
            color: #ffc107;
            cursor: pointer;
            position: relative;
        }
        .warning-icon .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .warning-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">GTA 5 Legal Calculator</h1>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="badgeNumber" class="form-label">Officer's Badge Number</label>
                <input type="text" id="badgeNumber" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="clientName" class="form-label">Client's Name</label>
                <input type="text" id="clientName" class="form-control">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="whisperingCheck">
                    <label class="form-check-label" for="whisperingCheck">Ensure client is whispering</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="privilegeCheck">
                    <label class="form-check-label" for="privilegeCheck">Client advised of attorney client privilege</label>
                </div>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col">
                <select id="preset" class="form-select">
                    <option value="">Select a preset...</option>
                    <option value="bank_robbery">Bank Robbery</option>
                </select>
            </div>
        </div>
        
        <table class="table table-striped">
            <thead>
                <tr>
                    <th style="width: 25%;">Charge</th>
                    <th style="width: 10%;">Jail Time</th>
                    <th style="width: 10%;">Fine</th>
                    <th style="width: 25%;">Description</th>
                    <th style="width: 10%;">Quantity</th>
                    <th style="width: 10%;">Individual Charge Discount (%)</th>
                    <th style="width: 10%;">Actions</th>
                </tr>
            </thead>
            <tbody id="charges"></tbody>
        </table>
        
        <div class="row mb-3">
            <div class="col">
                <button id="addCharge" class="btn btn-primary">Add Charge</button>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col">
                <label class="form-label">Global Discount (%)</label>
                <div id="discountButtons"></div>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <h3>Summary:</h3>
                <div id="licenseRevocationWarning" class="mb-3">
                    <strong>License Revocations:</strong> The following charges will result in a license revocation:
                    <ul id="licenseRevocationList"></ul>
                </div>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Pre-Discount</th>
                            <th>Post-Discount</th>
                            <th>Saved</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>Jail Time</th>
                            <td><span id="preTotalJailTime">0</span> days</td>
                            <td><span id="postTotalJailTime">0</span> days</td>
                            <td><span id="savedJailTime">0</span> days</td>
                        </tr>
                        <tr>
                            <th>Fine</th>
                            <td>$<span id="preTotalFine">0</span></td>
                            <td>$<span id="postTotalFine">0</span></td>
                            <td>$<span id="savedFine">0</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const charges = [
            { name: "Bank Robbery", jailTime: 1200, fine: 10000, description: "The act of or direct involvement in stealing property from a bank, including removing property from the vault.", stackable: false },
            { name: "Kidnapping", jailTime: 900, fine: 5000, description: "The act of or direct involvement in the unlawful taking and movement of a person by force, fraud, or by means of a credible threat against their will, or the unlawful seizure and detainment of a person against their will by means of force or use of a credible threat.", stackable: true, licenseRevocation: "Firearms License" },
            { name: "Felony Evading Arrest", jailTime: 800, fine: 4000, description: "The act of intentionally fleeing from a law enforcement officer attempting to make a lawful arrest or detainment by means of giving verbal or visual directions, the announcement of their presence, or the operation of their emergency vehicle (such as lights, sirens, or a combination of both.)", stackable: false },
            { name: "Reckless Driving", jailTime: 500, fine: 1200, description: "Reckless Driving shall be satisfied by a minimum of 3 separate traffic offences occurring simultaneously or within succession of each other, or, a speeding offence of greater than 40 mph over the speed limit, or, mounting the sidewalk / leaving the roadway.", stackable: false, licenseRevocation: "Driver's or Motorcycle License" }
        ];

        const chargesContainer = document.getElementById('charges');
        const addChargeBtn = document.getElementById('addCharge');
        const presetSelect = document.getElementById('preset');
        const discountButtonsContainer = document.getElementById('discountButtons');
        const preTotalJailTimeSpan = document.getElementById('preTotalJailTime');
        const postTotalJailTimeSpan = document.getElementById('postTotalJailTime');
        const savedJailTimeSpan = document.getElementById('savedJailTime');
        const preTotalFineSpan = document.getElementById('preTotalFine');
        const postTotalFineSpan = document.getElementById('postTotalFine');
        const savedFineSpan = document.getElementById('savedFine');
        const licenseRevocationWarning = document.getElementById('licenseRevocationWarning');
        const licenseRevocationList = document.getElementById('licenseRevocationList');

        let globalDiscount = 20;

        function createChargeElement(charge) {
            const chargeRow = document.createElement('tr');
            chargeRow.className = 'charge-item';
            if (charge && charge.licenseRevocation) {
                chargeRow.classList.add('license-revocation');
            }
            chargeRow.innerHTML = `
                <td>
                    <div class="charge-search-container">
                        <input type="text" class="charge-input" placeholder="Type to search charges" autocomplete="off">
                        <div class="custom-dropdown"></div>
                    </div>
                </td>
                <td class="jail-time"></td>
                <td class="fine"></td>
                <td class="description"></td>
                <td>
                    <input type="number" class="form-control quantity" value="1" min="1">
                </td>
                <td>
                    <input type="number" class="form-control individual-discount" value="0" min="0" max="100" placeholder="Discount %">
                </td>
                <td>
                    <button class="btn btn-danger remove-charge">Remove</button>
                </td>
            `;

            const chargeInput = chargeRow.querySelector('.charge-input');
            const dropdown = chargeRow.querySelector('.custom-dropdown');

            chargeInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                dropdown.innerHTML = '';
                dropdown.style.display = query ? 'block' : 'none';

                charges
                    .filter(c => c.name.toLowerCase().includes(query))
                    .forEach(c => {
                        const item = document.createElement('div');
                        item.className = 'custom-dropdown-item';
                        item.textContent = c.name;
                        item.addEventListener('click', function() {
                            chargeInput.value = c.name;
                            updateChargeDetails(chargeRow, c);
                            dropdown.style.display = 'none';
                        });
                        dropdown.appendChild(item);
                    });
            });

            chargeRow.querySelector('.remove-charge').addEventListener('click', removeCharge);
            chargeRow.querySelector('.quantity').addEventListener('input', calculateTotal);
            chargeRow.querySelector('.individual-discount').addEventListener('input', calculateTotal);

            if (charge) {
                chargeInput.value = charge.name;
                updateChargeDetails(chargeRow, charge);
            }

            return chargeRow;
        }

        function updateChargeDetails(chargeRow, charge) {
            chargeRow.querySelector('.jail-time').textContent = charge.jailTime;
            chargeRow.querySelector('.fine').textContent = charge.fine;
            const descriptionCell = chargeRow.querySelector('.description');
            descriptionCell.innerHTML = `
                <div class="description-short">${charge.description}</div>
                <span class="description-toggle">[more]<span class="tooltip-text">${charge.description}</span>
                </span>
                ${charge.licenseRevocation ? `
                <span class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="tooltip-text">License Revocation: ${charge.licenseRevocation}</span>
                </span>` : ''}
            `;
            const quantityInput = chargeRow.querySelector('.quantity');
            quantityInput.disabled = !charge.stackable;
            if (!charge.stackable) {
                quantityInput.value = 1;
            }
            if (charge.licenseRevocation) {
                chargeRow.classList.add('license-revocation');
            } else {
                chargeRow.classList.remove('license-revocation');
            }
            updateLicenseRevocationWarning();
            calculateTotal();
        }

        function removeCharge() {
            this.closest('.charge-item').remove();
            updateLicenseRevocationWarning();
            calculateTotal();
        }

        function updateLicenseRevocationWarning() {
            const revocations = new Set();
            document.querySelectorAll('.charge-item').forEach(item => {
                const chargeName = item.querySelector('.charge-input').value;
                const charge = charges.find(c => c.name === chargeName);
                if (charge && charge.licenseRevocation) {
                    revocations.add(`${charge.name}: ${charge.licenseRevocation}`);
                }
            });

            if (revocations.size > 0) {
                licenseRevocationWarning.style.display = 'block';
                licenseRevocationList.innerHTML = Array.from(revocations).map(r => `<li>${r}</li>`).join('');
            } else {
                licenseRevocationWarning.style.display = 'none';
            }
        }

function calculateTotal() {
            let totalJailTime = 0;
            let totalFine = 0;

            document.querySelectorAll('.charge-item').forEach(item => {
                const jailTime = parseInt(item.querySelector('.jail-time').textContent) || 0;
                const fine = parseInt(item.querySelector('.fine').textContent) || 0;
                const quantity = parseInt(item.querySelector('.quantity').value) || 1;
                const individualDiscount = parseInt(item.querySelector('.individual-discount').value) || 0;

                const discountedJailTime = jailTime * (1 - individualDiscount / 100);
                const discountedFine = fine * (1 - individualDiscount / 100);

                totalJailTime += discountedJailTime * quantity;
                totalFine += discountedFine * quantity;
            });

            const postDiscountJailTime = Math.round(totalJailTime * (1 - globalDiscount / 100));
            const postDiscountFine = Math.round(totalFine * (1 - globalDiscount / 100));
            const finalJailTime = Math.min(postDiscountJailTime, 4000);

            const savedJailTime = Math.round(totalJailTime) - finalJailTime;
            const savedFine = Math.round(totalFine) - Math.round(postDiscountFine);

            preTotalJailTimeSpan.textContent = Math.round(totalJailTime);
            postTotalJailTimeSpan.textContent = finalJailTime;
            savedJailTimeSpan.textContent = savedJailTime;
            preTotalFineSpan.textContent = Math.round(totalFine);
            postTotalFineSpan.textContent = Math.round(postDiscountFine);
            savedFineSpan.textContent = savedFine;
        }

        addChargeBtn.addEventListener('click', () => {
            chargesContainer.appendChild(createChargeElement());
        });

        presetSelect.addEventListener('change', () => {
            chargesContainer.innerHTML = '';
            if (presetSelect.value === 'bank_robbery') {
                chargesContainer.appendChild(createChargeElement(charges[0])); // Bank Robbery
                chargesContainer.appendChild(createChargeElement(charges[1])); // Kidnapping
                chargesContainer.appendChild(createChargeElement(charges[2])); // Felony Evading Arrest
                chargesContainer.appendChild(createChargeElement(charges[3])); // Reckless Driving
            }
            updateLicenseRevocationWarning();
            calculateTotal();
        });

        // Create discount buttons
        for (let i = 5; i <= 100; i += 5) {
            const button = document.createElement('button');
            button.textContent = i + '%';
            button.className = 'btn btn-outline-primary discount-btn';
            if (i === 20) {
                button.classList.add('active');
            }
            button.addEventListener('click', function() {
                globalDiscount = i;
                document.querySelectorAll('.discount-btn').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                calculateTotal();
            });
            discountButtonsContainer.appendChild(button);
        }
    </script>
</body>
</html>
